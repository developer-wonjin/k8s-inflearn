# k delete pods --all
# k delete svc  --all

# -----------------------------------------------------------
# Pod의 IP는 휘발성이므로 Service를 통해 고정된 접근 경로를 제공
# ClusterIP 타입 Service는 Cluster 내부에서만 접근 가능
# Service는 여러 Pod와 연결 가능하며, 트래픽은 라운드 로빈으로 분산됨
# -----------------------------------------------------------

apiVersion: v1
kind: Pod
metadata:
  name: pod-1                                # Pod 이름 (고유해야 함)
  labels:
     app: pod                                # Service가 선택할 라벨 (app=pod)
spec:
  nodeSelector:                              
    kubernetes.io/hostname: k8s-worker1      # 특정 노드(k8s-worker1)에 Pod 스케줄링
  containers:
  - name: container
    image: kubetm/app                        # 애플리케이션 이미지
    ports:
    - containerPort: 8080                    # 컨테이너 내부에서 서비스할 포트

---
apiVersion: v1
kind: Pod
metadata:
  name: pod-2                                # 두 번째 Pod (다른 노드에 배포)
  labels:
     app: pod                                # 동일 라벨 → 같은 Service에 묶임
spec:
  nodeSelector:
    kubernetes.io/hostname: k8s-worker2      # 특정 노드(k8s-worker2)에 Pod 스케줄링
  containers:
  - name: container
    image: kubetm/app
    ports:
    - containerPort: 8080                    # 컨테이너 내부 포트 (Service targetPort와 매칭)

---
apiVersion: v1
kind: Service
metadata:
  name: svc-1                                # Service 이름
spec:
  selector:
    app: pod                                 # 라벨이 app=pod인 Pod들을 자동으로 연결
  ports:
  - port: 9000                               # Service가 노출할 포트 (ClusterIP 기준)
    targetPort: 8080                         # 연결된 Pod들이 실제로 사용하는 포트

# -----------------------------------------------------------
# 사용 방법:
# Master Node에서 Service의 ClusterIP:9000 으로 접근
# 예) curl  <Service-IP>:9000/hostname
# 예) curl 10.111.85.132:9000/hostname
# Service가 연결된 Pod 중 하나에 랜덤하게 트래픽이 전달됨
# -----------------------------------------------------------
